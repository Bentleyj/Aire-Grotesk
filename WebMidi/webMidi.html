<html>
	<head>
		<title>Web Midi</title>
		<style>
			body {
			  background-color: white;
			  color: #eaeaea;
			  margin: 0;
			  padding: 1em;
			  text-align: center;
			}

			#value {
			  color: white;
			  font-size: 60px;
			}

			#meter {
			  margin-top:60px;
			}


			button {
			  color: black;
			  padding: 4px 16px;
			}

			.p {
			  padding: 0;
			  text-align: center;
			}

			@font-face {
			  font-family:'Decovar Alpha Regular24';      
			  src:url('https://www.axis-praxis.org/fonts/webfonts/DecovarAlpha-VF.woff2');
			}


			#para1 {
			  font-size:200px;
			  color: black;
			  font-family: "Decovar Alpha Regular24";
			  font-variation-settings: "SKLD" 0, "SKLA" 0;
			  font-stretch: 500%;
			  margin: 0;
			}
		</style>
	</head>
	<body>
		<canvas id="meter" width="900" height="150"></canvas>
		<p id="para1">RESPONSIVE!</p>
		<span id="value"><span>
		<script>
			var midi, data;
			var midiMap = {
				name: 'My Object',
				map: [
						{ name:'BLDA', value: 0, min: 0, max: 1000 },
						{ name:'TRMD', value: 0, min: 0, max: 1000 },
						{ name:'TRMC', value: 0, min: 0, max: 1000 },
						{ name:'SKLD', value: 0, min: 0, max: 1000 },
						{ name:'TRML', value: 0, min: 0, max: 1000 },
						{ name:'SKLA', value: 0, min: 0, max: 1000 },
						{ name:'TRMF', value: 0, min: 0, max: 1000 },
						{ name:'BLDB', value: 0, min: 0, max: 1000 },
						{ name:'WMX2', value: 0, min: 0, max: 1000 },
						{ name:'TRMB', value: 0, min: 0, max: 1000 },
						{ name:'TRMA', value: 0, min: 0, max: 1000 },
						{ name:'SKLB', value: 0, min: 0, max: 1000 },
						{ name:'TRMG', value: 0, min: 0, max: 1000 },
						{ name:'TRME', value: 0, min: 0, max: 1000 }
					],
				getSettingsString: function() {
					var s = "font-variation-settings: ";
					for(var i = 0; i < 14; i++) {
						s += " '";
						s += this.map[i].name;
						s += "' ";
						s += this.map[i].value;
						if(i === 13)
							s += ";";
						else
							s += ", ";
					}
					return s;
				}
			}
			// start talking to MIDI controller
			if (navigator.requestMIDIAccess) {
			  navigator.requestMIDIAccess({
			    sysex: false
			  }).then(onMIDISuccess, onMIDIFailure);
			} else {
			  console.warn("No MIDI support in your browser")
			}

			window.onload = function() {
				console.log(midiMap.getSettingsString());
			}

			function map(v, min1, max1, min2, max2) {
				var diff = max1 - min1;
				var v0 = v - min1;
				var p = v0 / diff;
				return min2 + p *(max2 - min2);
			}

			// on success
			function onMIDISuccess(midiData) {
			  // this is all our MIDI data
			  midi = midiData;
			  var allInputs = midi.inputs.values();
			  // loop over all available inputs and listen for any MIDI input
			  for (var input = allInputs.next(); input && !input.done; input = allInputs.next()) {
			    // when a MIDI value is received call the onMIDIMessage function
			    input.value.onmidimessage = gotMIDImessage;
			  }
			}
			var dataList = document.querySelector('#midi-data ul')

			function gotMIDImessage(messageData) {
			  var text = document.getElementById("para1");
			  var slider = messageData.data[1];
			  var amount = messageData.data[2];
			  if(slider > 7) {
			  	slider -= 8;
			  }
			  midiMap.map[slider].value = map(amount, 0, 127, midiMap.map[slider].min, midiMap.map[slider].max);
			  // if (messageData.data[1] == 0) {
			    // var skld = messageData.data[2]*10;  
			  // }
			  
			    var settings = midiMap.getSettingsString();//"font-variation-settings: 'SKLD' " + skld + ";" ;
			    text.setAttribute("style", ('font-variation-settings', settings));
			}

			// on failure
			function onMIDIFailure() {
			  console.warn("Not recognising MIDI controller")
			}
		</script>
	</body>
</html>